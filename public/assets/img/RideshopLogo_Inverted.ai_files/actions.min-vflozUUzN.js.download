define(["require","exports","tslib","react","modules/clean/auth/login_or_register/types","modules/clean/downloads","modules/clean/react/copy_to_dropbox/modal","modules/clean/react/modal","modules/clean/react/share_download/api","modules/clean/storage","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/react/share_download/api"],(function(e,o,n,t,r,a,i,s,l,c,d,u,p,_,m,g){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),t=n.__importDefault(t),a=n.__importStar(a),l=n.__importStar(l),u=n.__importStar(u),o.direct=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,s,c;return n.__generator(this,(function(n){switch(n.label){case 0:return i=e.downloadTestUrl,s=e.url,r||p.reportException({err:new Error("No encryption options provided for direct download action"),severity:"non-critical",tags:["sharing-encryption-options"]}),[4,o.authModalHelpers.authenticateForDownload(t||null,r)];case 1:if(n.sent(),!i)return[3,5];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,l.testDownload(i)];case 3:return n.sent(),[3,5];case 4:return n.sent()instanceof g.TooLargeError?m.Notify.error(_.intl.formatMessage({id:"pcsTpL",defaultMessage:"The zip file is too large."})):m.Notify.error(_.intl.formatMessage({id:"pllUQE",defaultMessage:"Failed to download zip file."})),[2];case 5:return n.trys.push([5,7,,8]),[4,l.fetchDownloadUrl(s)];case 6:return c=n.sent(),a.get({url:c}),[3,8];case 7:return n.sent(),m.Notify.error(_.intl.formatMessage({id:"6OUwIN",defaultMessage:"Failed to download."})),[3,8];case 8:return[2]}}))}))},o.toDropbox=function(e,r,a,l,c,_){return n.__awaiter(this,void 0,void 0,(function(){var m,g;return n.__generator(this,(function(n){switch(n.label){case 0:return"anonymous"!==a?[3,2]:(c||p.reportException({err:new Error("No encryption options provided for anonymous sharing action"),severity:"non-critical",tags:["sharing-encryption-options"]}),[4,o.authModalHelpers.authenticateForSaveToDropbox(c)]);case 1:return m=n.sent(),g=u.reload,[3,4];case 2:return m=l?l.id:-1,p.assert(-1!==m,"role isn't anonymous => user cannot be null or undefined!"),d.Viewer.get_viewer().is_user_signed_in(l)?[3,4]:(c||p.reportException({err:new Error("No encryption options provided for multiaccount sharing action"),severity:"non-critical",tags:["sharing-encryption-options"]}),[4,o.authModalHelpers.doMultiAccountAuthentication(a,c)]);case 3:n.sent(),n.label=4;case 4:return s.Modal.showInstance(t.default.createElement(i.CopyToDropboxModal,{shareToken:e,copyable:r,userId:m,role:a,onDismiss:g,folderPreviewSession:_})),[2]}}))}))},o.authModalHelpers={authenticateForDownload:function(o,a){return o!==r.LoginOrRegisterKind.DOWNLOAD||c.LocalStorage.get("has_seen_download_signup_modal")?Promise.resolve():new Promise((function(i,l){var d=function(){c.LocalStorage.set("has_seen_download_signup_modal",!0),i()},u=function(){c.LocalStorage.set("has_seen_download_signup_modal",!0),l()};new Promise((function(o,n){e(["modules/clean/auth/login_or_register/modal"],o,n)})).then(n.__importStar).then((function(e){var n=e.LoginOrRegisterModal;s.Modal.showInstance(t.default.createElement(n,{downloadAction:r.DownloadAction.DIRECT_DOWNLOAD,id:"shared-link-download-signup-modal",initialMode:r.Mode.REGISTER,kind:o,onAuthenticateSuccess:d,onCancel:u,signup_tag:"shmodel_download_register",encryptionOptions:a}))}))}))},authenticateForSaveToDropbox:function(o){return new Promise((function(a,i){var l=function(e){return a(e.id)};new Promise((function(o,n){e(["modules/clean/auth/login_or_register/modal"],o,n)})).then(n.__importStar).then((function(e){var n=e.LoginOrRegisterModal;s.Modal.showInstance(t.default.createElement(n,{downloadAction:r.DownloadAction.SAVE_TO_DROPBOX,id:"shared-link-immediate-signup-modal",initialMode:r.Mode.REGISTER,kind:r.LoginOrRegisterKind.DOWNLOAD,onAuthenticateSuccess:l,onCancel:i,signup_tag:"shmodel_modal_register",encryptionOptions:o}))}))}))},doMultiAccountAuthentication:function(o,r){return new Promise((function(a,i){new Promise((function(o,n){e(["modules/clean/auth/multi_account_login_modal"],o,n)})).then(n.__importStar).then((function(e){var n=e.MultiAccountLoginModal;s.Modal.showInstance(t.default.createElement(n,{onAuthenticateSuccess:a,onCancel:i,role:o,encryptionOptions:r}))}))}))}}}));
//# sourceMappingURL=actions.min.js-vfl6kxTG4.map