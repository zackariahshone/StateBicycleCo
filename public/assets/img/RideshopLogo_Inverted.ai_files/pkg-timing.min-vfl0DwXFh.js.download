define("modules/clean/metrics/coin",["require","exports","tslib","apex-metrics"],(function(t,e,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.newCoinState=function(){return{lastFlipTime:null,lastResult:!1,numTimesChecked:0}},e.observeCoin=function(t,e,r,o){if(!r.stickiness||!r.stickiness.limit)return{nextState:o,result:!1};var a=Date.now(),s=o.lastFlipTime,c=o.lastResult,u=o.numTimesChecked,l=!1;switch(r.stickiness.limit[".tag"]){case"n_results":l=u%r.stickiness.limit.n_results==0;break;case"n_seconds":l=!s||a-i.Instant.toMilliseconds(s)>i.Instant.toMilliseconds({value:r.stickiness.limit.n_seconds,unit:i.TimeUnit.SECONDS});break;case"permanent":l=0===u;break;case"independent":l=!0;break;case"other":default:return{nextState:o,result:!1}}if(l){var p=t()<(r.fraction||0);return{nextState:{lastFlipTime:{value:a,unit:i.TimeUnit.MILLISECONDS},lastResult:p,numTimesChecked:o.numTimesChecked+1},result:p}}return{nextState:n.__assign(n.__assign({},o),{numTimesChecked:o.numTimesChecked+1}),result:c}}})),define("modules/clean/metrics/filter",["require","exports","tslib","modules/clean/metrics/coin","modules/clean/metrics/serialization"],(function(t,e,n,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.makeCoinMap=function(t,e){for(var n={},r=0,o=t;r<o.length;r++){var a=o[r],s=a.metric_namespace;n[s]={dropPeriodCoin:a.drop_periods?{config:a.drop_periods,state:e[s]&&e[s].dropPeriodCoin||i.newCoinState()}:null,dropSamplesCoin:a.drop_samples?{config:a.drop_samples,state:e[s]&&e[s].dropSamplesCoin||i.newCoinState()}:null}}return n};var o=(function(){function t(t,e,n,i,r){this.randomEngine=t,this.clock=e,this.maxScopes=n,this.coinMap=i,this.configuredNamespaces=r}return t.prototype.extend=function(e,i,r){return new t(this.randomEngine,this.clock,e||this.maxScopes,n.__assign(n.__assign({},this.coinMap),i),r)},t.prototype.getState=function(){var t={};for(var e in this.coinMap)this.coinMap.hasOwnProperty(e)&&(t[e]={dropPeriodCoin:this.coinMap[e].dropPeriodCoin?n.__assign({},this.coinMap[e].dropPeriodCoin.state):null,dropSamplesCoin:this.coinMap[e].dropSamplesCoin?n.__assign({},this.coinMap[e].dropSamplesCoin.state):null});return t},t.prototype.getConfiguredNamespaces=function(){return this.configuredNamespaces},t.prototype.partitionAndSerializeSpans=function(t,e,n){var o=this,a=[],s=new Map,c=0;return t.forEach((function(t,u){var l=o.coinMap[u]||{},p=l.dropPeriodCoin,_=l.dropSamplesCoin;if(o.configuredNamespaces.has(u)){if(p){var d=i.observeCoin(o.randomEngine,o.clock,p.config,p.state),m=d.result,h=d.nextState;if(p.state=h,m)return}_&&(t=t.map((function(t){return{namespace:t.namespace,metricName:t.metricName,tags:t.tags,samples:t.samples.filter((function(){var t=i.observeCoin(o.randomEngine,o.clock,_.config,_.state),e=t.result,n=t.nextState;return _.state=n,!e}))}})).filter((function(t){return Object.keys(t.samples).length>0}))),0!==t.length&&(0===o.maxScopes||c<o.maxScopes?(a.push(r.formatSpansAsScope(n,u,t,e)),c++):s.set(u,t))}else s.set(u,t)})),[a,s]},t})();e.SpanGroupFilter=o})),define("modules/clean/metrics/index",["require","exports","apex-metrics","modules/clean/api_v2/noauth_client","modules/clean/metrics/sink"],(function(t,e,n,i,r){"use strict";function o(){return new n.BrowserPerformanceClock}function a(){return new n.SetTimeoutExecutor((function(){return{value:5*Math.random(),unit:n.TimeUnit.SECONDS}}))}function s(){return Math.random}Object.defineProperty(e,"__esModule",{value:!0});var c=new i.NoAuthApiV2Client,u=new r.Apiv2MetricsSink(c,o(),r.makeDefaultInitialization(c),r.makeDefaultCacheFactory(),a(),s());e.getMetricsReporter=function(){return n.MetricsReporterImpl.root(u,o())},e.getTestMetricsReporter=function(t,e,i,c,u,l){var p=u||o(),_=c||a(),d=e||r.makeDefaultInitialization(t),m=i||r.makeDefaultCacheFactory(),h=l||s();return n.MetricsReporterImpl.root(new r.Apiv2MetricsSink(t,p,d,m,_,h),p)}})),define("modules/clean/metrics/serialization",["require","exports"],(function(t,e){"use strict";function n(t){var e=[];for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];e.push({name:{value:{".tag":"string_value",string_value:n}},value:{value:{".tag":"string_value",string_value:i}}})}return e}function i(t){return{name:{value:{".tag":"string_value",string_value:t.metricName}},data:{".tag":"numerical_data",samples:t.samples}}}Object.defineProperty(e,"__esModule",{value:!0}),e.formatTags=n,e.formatSamples=i,e.formatSpansAsScope=function(t,e,r,o){var a=new Map;return r.forEach((function(t){var e,n=JSON.stringify(t.tags);a.has(n)||a.set(n,{});var i=a.get(n);i.hasOwnProperty(t.metricName)?(e=i[t.metricName].samples).push.apply(e,t.samples):i[t.metricName]=t})),{timestamp_sec:t,metric_namespace:e,tags:n(o),descendants:Array.from(a.values()).map((function(t){return{tags:n(t[Object.keys(t)[0]].tags),metrics:Object.keys(t).map((function(e){return i(t[e])}))}}))}}})),define("modules/clean/metrics/sink",["require","exports","tslib","apex-metrics","modules/clean/metrics/filter","modules/core/browser_detection","modules/constants/page_load","modules/core/exception"],(function(t,e,n,i,r,o,a,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o=n.__importStar(o),s=n.__importStar(s);var c={".tag":"trigger_heartbeat"},u={".tag":"trigger_publish"},l={client_version:6,implementation:{".tag":"typescript"}};function p(t,e,n){var i,r=[];return e.forEach((function(t){return r.push(t)})),{scopes:t,known_namespaces:r,environment:"prod",artifact_name:"dropbox-web",artifact_version:a.REPO_REV,client_metadata:l,trigger:n,os:o.mac?{name:{".tag":"mac"},version:"unknown"}:o.windows?{name:{".tag":"windows"},version:(i=o.windowsInfo,i.windowsXP||i.windowsXPx64?"XP":i.windowsVista?"Vista":i.windows7?"7":i.windows8?"8":i.windows8_1?"8.1":i.windows10?"10 Unknown":"unknown")}:o.is_android()?{name:{".tag":"android"},version:"unknown"}:o.iOS?{name:{".tag":"ios"},version:"unknown"}:{name:{".tag":"unknown_os"},version:"unknown"}}}e.makeDefaultInitialization=function(t){var i=this;return function(r){return n.__awaiter(i,void 0,void 0,(function(){var i,o,a,u,l;return n.__generator(this,(function(n){switch(n.label){case 0:return i=[],!r||!(o=(function(t){var n,i,r=t.getItem(e._PERSISTENTCACHE_KEY);if(null===r)return null;var o,a,c,u=Math.floor(Date.now()/1e3),l=[];try{n=JSON.parse(r),o=n.config,i=n.timeStored,a=void 0===i?0:i,c=n.state}catch(t){return s.reportException({err:t,tags:["js:web:amp-sink","js:web:amp-sink/local-storage"],severity:"non-critical"}),null}if(a>u)return s.reportStack("Sink cache was stored in the future instead of the past!",{tags:["js:web:amp-sink","js:web:amp-sink/local-storage"]}),null;o.reporting_configs&&(l=o.reporting_configs.map((function(t){return t.metric_namespace})),o.reporting_configs=o.reporting_configs.filter((function(t){return void 0!==t.max_time_until_refresh_seconds&&t.max_time_until_refresh_seconds>u-a})));return{config:o,state:c,knownNamespaces:l}})(r))||(i=o.knownNamespaces,a=new Set,o.config.reporting_configs.forEach((function(t){return a.add(t.metric_namespace)})),i.some((function(t){return!a.has(t)})))?(u=new Set,i.forEach((function(t){return u.add(t)})),[4,t.ns("client_metrics").rpc("record",p([],u,c),{})]):[2,o];case 1:return l=n.sent(),[2,{knownNamespaces:i,config:l,state:{}}]}}))}))}},e._PERSISTENTCACHE_KEY="amp-sink-cache",e.makeDefaultCacheFactory=function(){return function(){return window.localStorage||null}};var _=(function(){function t(t,e,n,i,r,o){var a=this;this.client=t,this.clock=e,this.initializer=n,this.cacheFactory=i,this.executor=r,this.randomEngine=o,this.nextRequest=null,this.queuedSpans=new Map,this.knownNamespaces=new Set,this.cache=this.cacheFactory(),this.currentRequest=this.initializer(this.cache).then((function(t){return t&&a.updateConfiguration(t.config,t.state),t.config||null}))}return t.prototype.updateConfiguration=function(t,n){var r=this,o=t.reporting_configs,a=void 0===o?[]:o,s=t.stop_publication_for_seconds,c=t.publication_interval_seconds;a.forEach((function(t){r.knownNamespaces.add(t.metric_namespace)})),this.updateBlackoutCallback({value:s,unit:i.TimeUnit.SECONDS}),this.updatePublishTimer({value:c,unit:i.TimeUnit.SECONDS}),this.updateSpanGroupFilter(t,n,this.knownNamespaces),this.cache&&(function(t,n,i){try{var r=Math.floor(Date.now()/1e3);t.setItem(e._PERSISTENTCACHE_KEY,JSON.stringify({config:n,timeStored:r,state:i}))}catch(t){}})(this.cache,t,n)},t.prototype.updateSpanGroupFilter=function(t,e,n){for(var i=t.reporting_configs,o=void 0===i?[]:i,a=t.max_scopes_per_request,s=new Set,c=n.values(),u=c.next();!u.done;u=c.next())s.add(u.value);var l=r.makeCoinMap(o,e);this.spanGroupFilter=this.spanGroupFilter?this.spanGroupFilter.extend(a,l,s):new r.SpanGroupFilter(this.randomEngine,this.clock,a,l,s)},t.prototype.updateBlackoutCallback=function(t){var e=this;0!==t.value?(this.blackoutCallback=function(){return e.blackoutCallback=null,!1},this.executor.executeEvery(t,this.blackoutCallback)):this.blackoutCallback=null},t.prototype.updatePublishTimer=function(t){var e=this;if(0!==t.value){if(!this.publishTimer||i.Instant.toMilliseconds(this.publishTimer.period)!==i.Instant.toMilliseconds(t)){var n={period:t,callback:function(){return e.publishTimer===n&&(e.nextRequest=e.currentRequest.then((function(){e.nextRequest=null,e.currentRequest=e.send()})),!0)}};this.publishTimer=n,this.executor.executeEvery(this.publishTimer.period,this.publishTimer.callback)}}else this.publishTimer=null},t.prototype.send=function(){return n.__awaiter(this,void 0,void 0,(function(){var t,e,i,r,a,s,c,l,_,d,m,h,f,g,v;return n.__generator(this,(function(n){switch(n.label){case 0:if(this.blackoutCallback)return[2,null];for(t=Math.floor(Date.now()/1e3),e=[[o.chrome,"chrome"],[o.edge,"edge"],[o.mozilla,"firefox"],[o.msie,"msie"],[o.safari,"safari"]],i="other",r=0,a=e;r<a.length;r++)if((s=a[r])[0]){i=s[1];break}if(c={browser:i},l=this.spanGroupFilter.partitionAndSerializeSpans(this.queuedSpans,c,t),_=l[0],d=l[1],m=null,this.queuedSpans=d,!(h=_.length>0))for(f=this.spanGroupFilter.getConfiguredNamespaces(),g=this.knownNamespaces.values(),v=g.next();!v.done;v=g.next())if(!f.has(v.value)){h=!0;break}return h?[4,this.client.ns("client_metrics").rpc("record",p(_,this.knownNamespaces,u),{})]:[3,2];case 1:m=n.sent(),this.updateConfiguration(m,this.spanGroupFilter.getState()),n.label=2;case 2:return[2,m]}}))}))},t.prototype.recordSpan=function(t){var e=this;this.knownNamespaces.add(t.namespace),this.queuedSpans.has(t.namespace)||this.queuedSpans.set(t.namespace,[]),this.queuedSpans.get(t.namespace).push(t),this.nextRequest||(this.nextRequest=this.currentRequest.then((function(){e.publishTimer||(e.currentRequest=e.send()),e.nextRequest=null})))},t})();e.Apiv2MetricsSink=_})),define("modules/clean/perf_tools/resource_utils",["require","exports","tslib","modules/core/browser","modules/clean/js_client_stopwatch","modules/clean/perf_tools/cpu_utils"],(function(t,e,n,i,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importStar(o),e.logResourcesData=function(t){(function(t){var e=window.requireContexts;if(!e)return;var n=o.listExecutionPerfMeasurementsForRequireContexts(e),i=r.JSStopwatch.createDetachedStopwatch("resource_init_timeline",t);n.forEach((function(t){var e=i.startSpan(t.name,{startTime:t.startTime});i.addSpanAnnotation(t.name,"totalTimeNs",Math.round(1e6*t.totalTime).toString(),e),i.endSpan(t.name,{endTime:t.startTime+t.totalTime,spanId:e})})),i.logData()})(t),(function(t){var e=i.performance();if(!e||!e.getEntriesByType)return;var n=r.JSStopwatch.createDetachedStopwatch("resource_timeline",t),o={},a=e.getEntriesByType("resource");if(a instanceof Array)for(var u=0,l=a;u<l.length;u++){var p=l[u],_=s(p);if(_){var d=o[_]||0;o[_]=d+1,d>0&&(_=_+"-"+d);var m=n.startSpan(_,{startTime:p.startTime,async:!0}),h=c(p);n.addSpanAnnotation(_,"type",h,m),0===p.transferSize?n.addSpanAnnotation(_,"cached","true",m):void 0===p.transferSize?n.addSpanAnnotation(_,"cached","unknown",m):n.addSpanAnnotation(_,"cached","false",m),p.responseEnd<p.startTime?(n.addSpanAnnotation(_,"negativeSpanLength",(p.responseEnd-p.startTime).toString(),m),n.endSpan(_,{endTime:p.startTime,spanId:m})):n.endSpan(_,{endTime:p.responseEnd,spanId:m})}}n.logData()})(t)};var a=document&&document.createElement?document.createElement("a"):null;function s(t){if(a){if(a.href=t.name,a.host.match(/dropboxstatic.com$/)&&a.pathname.match(/^\/static/)){var e=a.pathname,n=e.match(/vfl[a-zA-Z0-9]*\.[a-z]*$/);n&&n.index&&(e=e.substring(0,n.index-1));for(var i=0,r=["/static/js/","/static/"];i<r.length;i++){var o=r[i];e.startsWith(o)&&(e=e.substring(o.length))}return e}return a.host.match(/photos-[0-9]+.dropbox.com$/)&&a.pathname.match(/^\/t\/2/)?"/thumbnail":void 0}}function c(t){var e=t.name,n=t.initiatorType,i=e.lastIndexOf(".");if(i>0){var r=e.substring(i);if([".png",".gif",".jpg",".svg"].indexOf(r)>-1)return"img";if(".js"===r)return"script";if(".css"===r)return"css"}return-1===["css","img","script","link"].indexOf(n)?"xmlhttprequest"===n?"ajax":"other":n}e.logResourceTiming=function(t){var e=i.performance();if(e&&e.getEntriesByType){var n=e.getEntriesByType("resource").filter((function(e){return-1!==e.name.indexOf(t)}))[0];if(n&&n.responseEnd){var o="resource_response_end_"+t;return r.JSStopwatch.create_stopwatch_if_not_exist("resource_timing"),r.JSStopwatch.recordTrace(o,{stopwatchName:"resource_timing",traceTime:n.responseEnd}),n}}},e.summarizePerformanceResourceTimings=function(t,e){void 0===e&&(e=void 0);var n={pre:{},total:{}};if(r.JSStopwatch.create_stopwatch_if_not_exist("resource_timeline"),t instanceof Array)for(var i=function(t){var i=c(t),r=[];e&&t.responseEnd<=e&&(i in n.pre||(n.pre[i]={count:0,total_time:0,last_transfer_end:0}),r.push(n.pre[i])),i in n.total||(n.total[i]={count:0,total_time:0,last_transfer_end:0}),r.push(n.total[i]),r.forEach((function(e){var n;e.count++,e.total_time+=t.duration,e.last_transfer_end=Math.max(e.last_transfer_end,t.responseEnd),"css"!==(n=i)&&"script"!==n&&"img"!==n||void 0===t.transferSize||void 0===t.encodedBodySize||(e.total_size=e.total_size||0,e.transfer_size=e.transfer_size||0,0!==t.transferSize&&(e.transfer_size+=t.encodedBodySize),e.total_size=e.total_size||0,e.total_size+=t.encodedBodySize)}))},o=0,a=t;o<a.length;o++){i(a[o])}return n}})),define("modules/clean/perf_tools/cpu_utils",["require","exports","modules/clean/js_client_stopwatch"],(function(t,e,n){"use strict";var i;function r(t){if(t.require&&t.require.perfMeasurements){var e=0;return t.require.perfMeasurements.map((function(t){var n=t.name,i=t.startTime,r=t.totalTime;return n.endsWith("anon")&&(n+="-"+e++),{jsExecutionType:c(n),name:n,startTime:i,totalTime:r}}))}var n=t.module_callback_times;return Object.keys(n).filter((function(t){return n[t].callbackDuration&&n[t].callbackTime})).map((function(t){return{jsExecutionType:c(t),name:t,startTime:n[t].callbackTime,totalTime:n[t].callbackDuration}}))}function o(t){var e=[];for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];e=e.concat(r(i))}return e}function a(t){return Object.keys(t).map((function(e){var n=t[e];return{measurement:{jsExecutionType:s(e),name:e,startTime:n.start,totalTime:n.end-n.start},annotations:n.annotations}}))}function s(t){return t.startsWith("dws-processChunk")?i.DWS:i.UNKNOWN}function c(t){return t.startsWith("execCb.anon")||t.startsWith("overhead.anon")||t.startsWith("execCb.require-tier")||t.startsWith("overhead.require-tier")?i.OTHER:t.startsWith("execCb")||t.startsWith("overhead")?i.MODULE:i.UNKNOWN}Object.defineProperty(e,"__esModule",{value:!0}),(function(t){t.DWS="dws",t.MODULE="module",t.OTHER="other",t.UNKNOWN="unknown"})(i=e.JSExecutionType||(e.JSExecutionType={})),e.ALL_JS_EXECUTION_TYPES=[i.DWS,i.MODULE,i.OTHER,i.UNKNOWN],e.getAllGlobalExecutionPerfMeasurements=function(){var t=[];return window.ensemble&&window.ensemble.getJSStopwatchData&&(t=t.concat(a(window.ensemble.getJSStopwatchData()).map((function(t){return t.measurement})))),window.requireContexts&&(t=t.concat(o(window.requireContexts))),t},e.listExecutionPerfMeasurementsForRequireContexts=o,e.listAnnotatedExecutionPerfMeasurementsForEnsemble=a,e.cumulativeExecutionTimesBefore=function(t,e){var n={},i=function(i){if(t.hasOwnProperty(i)){var r=t[i];n[i]={},e.forEach((function(t){0<t.startTime&&t.startTime<r&&(n[i][t.jsExecutionType]=n[i][t.jsExecutionType]||0,n[i][t.jsExecutionType]+=t.totalTime)}))}};for(var r in t)i(r);return n},e.logCumulativeExecutionTimes=function(t,i){var r=n.JSStopwatch.createDetachedStopwatch("cumulative_cpu_time",t),o=function(t){i.hasOwnProperty(t)&&e.ALL_JS_EXECUTION_TYPES.forEach((function(e){r.recordTrace("cpu_before_"+t+"_due_to_"+e,i[t][e]||0)}))};for(var a in i)o(a);r.logData()}})),define("modules/clean/perf_tools/browser_perf_utils",["require","exports","tslib","modules/core/browser","modules/core/xhr","modules/constants/request","modules/clean/js_client_stopwatch","modules/constants/webtiming"],(function(t,e,n,i,r,o,a,s){"use strict";function c(t){var e=i.performance();if(e&&e.timing){var n=e.timing,c={navigation_start:n.navigationStart,unload_event_start:n.unloadEventStart,unload_event_end:n.unloadEventEnd,redirect_start:n.redirectStart,redirect_end:n.redirectEnd,fetch_start:n.fetchStart,domain_lookup_start:n.domainLookupStart,domain_lookup_end:n.domainLookupEnd,connect_start:n.connectStart,secure_connect_start:n.secureConnectionStart,connect_end:n.connectEnd,request_start:n.requestStart,response_start:n.responseStart,response_end:n.responseEnd,dom_loading:n.domLoading,dom_interactive:n.domInteractive,dom_content_loaded_event_start:n.domContentLoadedEventStart,dom_content_loded_event_end:n.domContentLoadedEventEnd,dom_complete:n.domComplete,load_event_start:n.loadEventStart,load_event_end:n.loadEventEnd},u={};u.request_id=o.REQUEST_ID,u.referrer=document.referrer;var l=a.JSStopwatch.createDetachedStopwatch("browser_perf",t);for(var p in c)c.hasOwnProperty(p)&&(u[p]=c[p],c[p]&&l.recordTrace(p,c[p]-n.navigationStart));l.logData(),s.LOG_BROWSER_PERFORMANCE_INFO&&r.sendXhr("/alternate_wtl_browser_performance_info",u)}}Object.defineProperty(e,"__esModule",{value:!0}),i=n.__importStar(i),r=n.__importStar(r),o=n.__importStar(o),s=n.__importStar(s),e.logBrowserPerfData=function(t){(function(t){var e=i.performance();if(!e||!e.getEntriesByType)return;var n=a.JSStopwatch.createDetachedStopwatch("performance_marks",t),r=e.getEntriesByType("mark");if(r instanceof Array)for(var o=0,s=r;o<s.length;o++){var c=s[o];n.recordTrace(c.name,c.startTime)}n.logData()})(t),c(t)},e.logBrowserPerformanceInfo=c})),define("modules/clean/perf_tools/web_timing_logger_types",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(function(){function t(){}return t.getFromNavigation=function(e){switch(e.type){case e.TYPE_NAVIGATE:return t.NAVIGATE;case e.TYPE_RELOAD:return t.RELOAD;case e.TYPE_BACK_FORWARD:return t.BACK_FORWARD}},t.NAVIGATE="navigate",t.RELOAD="reload",t.BACK_FORWARD="back_forward",t})();e.NavigationType=n;var i=(function(){function t(e,n,i,r,o){void 0===i&&(i=!1),void 0===r&&(r=!0),this.name=e,this.flag=1<<n,this.triggersLogging=i,this.timestampPrefix=o||e,this.ordered=r,t.allEvents.push(this)}return t.allEvents=[],t.APPLICATION_START=new t("application_code_start",1),t.LOAD_END=new t("load_end",2,!0,!1),t.MARK_TIME_TO_VIEW=new t("mark_time_to_view",3,!0,!0,"TTV"),t.FETCHED_DATA_FOR_TTI=new t("fetched_data_required_for_tti",4),t.MARK_TIME_TO_INTERACTIVE=new t("mark_time_to_interactive",5),t.TIME_TO_INTERACTIVE=new t("time_to_interactive",6,!0,!0,"TTI"),t})();e.WebTimerEvent=i})),define("modules/clean/perf_tools/web_timing_utils",["require","exports","tslib","modules/core/browser"],(function(t,e,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i=n.__importStar(i);var r=(function(){function t(){}return t.generateCorrelationId=function(){return Math.random().toString(36).substring(2)},t.getNow=function(){var t=i.performance();if(t&&t.timing&&t.now){var e=t.timing;return(e.navigationStart||e.fetchStart)+Math.floor(t.now())}return Date.now()},t.newContext=function(e,n){var r;if(void 0===n&&(n="unnamed_timer"),e)r=t.getNow();else{var o=i.performance();if(o&&o.timing){var a=o.timing;r=a.navigationStart||a.fetchStart}else r=t.getNow()}return{initialized:!1,is_pagelet:!1,is_dws:!1,is_dws2:!1,is_early_ensemble:!1,is_page_restore:!1,log_time_to_view:!1,log_time_to_interactive:!1,ttv_at_dom_interactive:!1,tti_at_dom_interactive:!1,source_type:"web",subtypes:{},tti_exclusion_flow:"",have_logged_web_timing:!1,delayed_tti_for_css:!1,timing_results:null,start_time:r,time_to_view:null,time_to_interactive:null,correlation_id:t.generateCorrelationId(),timesStagesWereReached:{},context_name:n}},t})();e.WebTimingUtil=r;var o=(function(){function t(t){this.canceled=!1,this.callback=t}return t.prototype.exec=function(){this.canceled||this.callback()},t.prototype.cancel=function(){this.canceled=!0},t.prototype.isCanceled=function(){return this.canceled},t})();e.CancellableCallback=o})),define("modules/clean/visibility_logging",["require","exports","modules/clean/js_client_stopwatch","modules/clean/js_basic_stopwatch"],(function(t,e,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.logPaintPerformance=function(t){if(window.performance&&window.performance.getEntriesByType){var e=window.performance.getEntriesByType("paint").map((function(t){return{type:i.TimingDataType.Trace,name:t.name,endTime:t.startTime}}));if(e.length>0){var r=n.JSStopwatch.createDetachedStopwatch("paint",t);r.recordEntries(e),r.logData()}}},e.logVisibilityChangeEvents=function(t,e){if(window.performance&&window.performance.getEntriesByType){var r=Number.MAX_VALUE;t.time_to_interactive&&(r=t.time_to_interactive-t.start_time);var o,a=window.performance.getEntriesByType("mark").filter((function(t){return t.name.startsWith("VisibilityState.")})).map((function(t){return{visibility:t.name,time:t.startTime}})),s={"VisibilityState.visible":0,"VisibilityState.hidden":0},c=function(t){o&&o.time<r&&(s[o.visibility]=(s[o.visibility]||0)+Math.min(t,r)-o.time)},u=[];for(var l in a.forEach((function(t,e){c(t.time),u.push({type:i.TimingDataType.Trace,name:"visibility-change-"+e,endTime:t.time,annotations:{visibility:t.visibility}}),o=0===e?{visibility:t.visibility,time:0}:t})),c(window.performance.now()),s)s.hasOwnProperty(l)&&u.push({type:i.TimingDataType.Trace,name:"total-"+l+"-time",endTime:s[l]});var p=n.JSStopwatch.createDetachedStopwatch("visibility",e);p.recordEntries(u),p.logData()}}})),define("modules/clean/web_module_timing",["require","exports","modules/pagelet_config"],(function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.get_module_times=function(){var t=n.REQUIREJS_CONTEXT_NAME,e=window.requireContexts[t].module_callback_times,i=[];for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];if(null!=o.loadTime){var a={load_time:o.loadTime,callback_duration:o.callbackDuration,callback_time:o.callbackTime,name:o.name,url:o.url,parent:o.parent};i.push(a)}}return i},e.add_module=function(){}})),define("modules/clean/web_timing_logger",["require","exports","tslib","apex-metrics","modules/clean/metrics/index","modules/clean/devtools/panels/performance/perf_hub_actions","modules/clean/event_load","modules/clean/web_module_timing","modules/clean/window_util","modules/clean/perf_tools/resource_utils","modules/clean/perf_tools/web_timing_logger_types","modules/clean/perf_tools/web_timing_utils","modules/clean/js_client_stopwatch","modules/clean/perf_tools/browser_perf_utils","modules/clean/init_react","modules/clean/perf_tools/cpu_utils","modules/clean/js_basic_stopwatch","modules/constants/request","modules/constants/webtiming","modules/constants/page_load","modules/core/browser","modules/core/exception","modules/core/xhr","dropbox/proto/js_init_data/web_timing_logger/web_timing_logger","modules/clean/visibility_logging"],(function(t,e,n,i,r,o,a,s,c,u,l,p,_,d,m,h,f,g,v,w,S,T,b,y,E){"use strict";var x;Object.defineProperty(e,"__esModule",{value:!0}),a=n.__importStar(a),c=n.__importStar(c),g=n.__importStar(g),v=n.__importStar(v),w=n.__importStar(w),S=n.__importStar(S),T=n.__importStar(T),b=n.__importStar(b),(function(t){t[t.NEW=1]="NEW",t[t.RUNNING=2]="RUNNING",t[t.ABORTED=3]="ABORTED",t[t.CLOSED=4]="CLOSED"})(x||(x={})),e.perfHubClassName="perf-hub-link-container";var I=["navigation_type","referrer","repo_rev","source_type","active_user_id"],O=["tti_flow","tti_exclusion_flow","is_dws2"];function k(){return"hidden"===window.document.visibilityState}var N=[[l.WebTimerEvent.APPLICATION_START,l.WebTimerEvent.MARK_TIME_TO_VIEW,l.WebTimerEvent.FETCHED_DATA_FOR_TTI,l.WebTimerEvent.MARK_TIME_TO_INTERACTIVE],[l.WebTimerEvent.TIME_TO_INTERACTIVE]].reverse(),A=1;var C=["requirejs_start","ensemble_payload_start","body_start"];var D=["craft_fast_prefetch_done","dws_core_externals_loaded","dws_ensemble_init","dws-processChunk-embedded-app-done-1","dws-processChunk-embedded-app-require_config-1","ensemble_init","module_init","last_js_const_end","pagelet_render_on_page_embedded-app","pagelet_css_loaded_embedded-app"];var R,M=(function(){function t(){_.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger")}return t.prototype.buildBaseParams=function(t,e,n){void 0===n&&(n={});var i=t.start_time,r=t.subtypes||{};t.tti_flow&&(r.tti_flow=t.tti_flow);var o,a,s={log_source:e.name,subtypes:JSON.stringify(r),correlation_id:t.correlation_id};t.extra_columns&&Object.keys(t.extra_columns).forEach((function(e){var n=t.extra_columns[e];n&&(s[e]=n)})),Object.keys(n).forEach((function(t){var e=n[t];e&&(s[t]=e)})),g.IS_HTTP2&&(s.is_spdy=!0),t.is_pagelet&&(s.is_pagelet=!0),t.is_dws&&(s.is_dws=!0),t.is_early_ensemble&&(s.is_early_ensemble=!0),s.delayed_tti_for_css=t.delayed_tti_for_css,""!==t.tti_exclusion_flow&&(s.tti_exclusion_flow=t.tti_exclusion_flow),o=t.log_time_to_view&&null!=t.time_to_view?t.time_to_view-i:null,a=t.log_time_to_interactive&&null!=t.time_to_interactive?t.time_to_interactive-i:null;var c={navigation_type:t.is_page_restore?l.NavigationType.RELOAD:this.get_navigation_type(),server_request_start_time:g.REQUEST_START_TIME,extra_columns:JSON.stringify(s),subtypes:JSON.stringify(r),source_type:t.source_type,page_load_time:t.end_time-t.start_time,repo_rev:w.REPO_REV};if(X(c),t.log_time_to_view&&(c.time_to_view=o),t.log_time_to_interactive&&(c.time_to_interactive=a),c.url=S.get_href(),0===c.url.indexOf("/dws2/")&&(c.url=c.url.substring("/dws2/".length-1)),c.referrer=document.referrer,c.request_id=t.request_id||g.REQUEST_ID,c.request_tracing_enabled=g.REQUEST_TRACING_ENABLED,window.ensemble&&window.ensemble.viewer){var u=window.ensemble.viewer.getActiveUser();u&&(c.active_user_id=u.userId),c.dws_page_name=window.ensemble.getPageName()}return c},t.prototype.get_navigation_type=function(){var t=S.performance();if(t&&t.navigation){var e=t.navigation;return l.NavigationType.getFromNavigation(e)}},t.prototype.log=function(t,n,i){void 0===i&&(i=!1);var r=_.JSStopwatch.startSpan("wtl_endpoint",{stopwatchName:"web_timing_logger"});_.JSStopwatch.addSpanAnnotation("wtl_endpoint","navigation_type",n.navigation_type,{stopwatchName:"web_timing_logger",spanId:r});var a=b.sendXhr("/alternate_wtl",n);a.onreadystatechange=function(t){if(a.readyState===XMLHttpRequest.DONE&&200===a.status){_.JSStopwatch.endSpan("wtl_endpoint",{stopwatchName:"web_timing_logger",spanId:r});var n=document.getElementsByClassName(e.perfHubClassName);if(i&&n.length){var s=JSON.parse(a.responseText);s.status&&o.PerfHubActions.add_web_timing_details(s)}}}},t})(),P=(function(t){function e(){return t.call(this)||this}return n.__extends(e,t),e.prototype.shouldLog=function(t){return t.initialized&&!t.have_logged_web_timing&&void 0!==t.end_time&&(!t.log_time_to_view||null!=t.time_to_view)&&(!t.log_time_to_interactive||null!=t.time_to_interactive)},e.prototype.logTiming=function(t,e){t.have_logged_web_timing=!0;var n=this.buildBaseParams(t,e),i=z(t,n);return this.log(t,n,!1),i},e.prototype.get_navigation_type=function(){return"ajax"},e})(M),L=(function(t){function e(){var e=t.call(this)||this;return e.metricsReporter=r.getMetricsReporter(),e}return n.__extends(e,t),e.prototype.shouldLog=function(t){if(!t.initialized||t.have_logged_web_timing)return!1;var e=S.performance();if(!e||!e.timing)return!1;var n=e.timing,i=t.start_time,r=t.end_time;return!(!i||!r)&&(!(t.log_time_to_view&&!(t.ttv_at_dom_interactive&&n.domInteractive||null!=t.time_to_view))&&!(t.log_time_to_interactive&&!(t.tti_at_dom_interactive&&n.domInteractive||null!=t.time_to_interactive)))},e.prototype.logTiming=function(t,e){var n=S.performance(),r=n.timing,o=h.getAllGlobalExecutionPerfMeasurements(),a=t.timesStagesWereReached["dws_embedded-app_require_config_callback"];void 0===a?a=t.timesStagesWereReached.application_code_start:t.timesStagesWereReached.hasOwnProperty("application_code_start")&&(a=Math.min(a,t.timesStagesWereReached.application_code_start)),_.JSStopwatch.startSpan("process_nav_timing",{stopwatchName:"web_timing_logger"});var s=this.buildBaseParams(t,e,{}),c=z(t,s),p=window.ensemble&&window.ensemble.getJSStopwatchData?window.ensemble.getJSStopwatchData():{},f=n.getEntriesByType?n.getEntriesByType("resource"):[],g=n.getEntriesByType?u.summarizePerformanceResourceTimings(f,a):{pre:{},total:{}};if(s.browser_time=(r.redirectStart||r.fetchStart)-t.start_time,s.redirect_time=r.fetchStart-t.start_time,s.dns_time=r.domainLookupEnd-t.start_time,s.tcp_connect_time=(r.secureConnectionStart||r.requestStart)-t.start_time,s.ssl_connect_time=r.requestStart-t.start_time,s.time_to_first_byte=r.responseStart-t.start_time,s.time_to_last_byte=r.responseEnd-t.start_time,s.dom_load_time=r.domContentLoadedEventEnd-t.start_time,s.idle_cpu_time=t.timing_results?Math.round(t.timing_results.idleCPUTime):void 0,s.total_tracked_cpu_time=t.timing_results?Math.round(t.timing_results.totalTrackedCPUTime):void 0,s.untracked_time_after_first_byte=t.timing_results&&null!=t.timing_results.untrackedTimeAfterFirstByte?Math.round(t.timing_results.untrackedTimeAfterFirstByte):void 0,S.performance().getEntriesByType&&((function(t,e){for(var n in t)t.hasOwnProperty(n)&&(e["resource_"+n+"_count"]=t[n].count,e["resource_"+n+"_avg_time"]=t[n].total_time/t[n].count||1,void 0!==t[n].total_size&&(e["resource_"+n+"_total_size"]=t[n].total_size),void 0!==t[n].transfer_size&&(e["resource_"+n+"_transfer_size"]=t[n].transfer_size))})(g.total,s),(function(t,e){var n;for(n in t)if(t.hasOwnProperty(n)){var i=t[n];for(var r in i)if(i.hasOwnProperty(r)){var o=i[r].transfer_size,a=i[r].total_size,s=i[r].count,c=i[r].total_time;if(e.recordTrace(n+"_"+r+"_count",s),e.recordTrace(n+"_"+r+"_total_time",c),void 0!==o&&void 0!==a&&a>0){var u=o/a;e.recordTrace(n+"_"+r+"_transferred_size",o),e.recordTrace(n+"_"+r+"_total_size",a),e.recordTrace(n+"_percent_"+r+"_transferred",100*u)}e.recordTrace(n+"_last_"+r+"_transfer_end",i[r].last_transfer_end)}}e.logData()})(g,_.JSStopwatch.createDetachedStopwatch("resources_percent_transferred",c)),_.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_resources","1",{stopwatchName:"web_timing_logger"})),X(s),_.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_modules","1",{stopwatchName:"web_timing_logger"}),_.JSStopwatch.endSpan("process_nav_timing",{stopwatchName:"web_timing_logger"}),t.is_pagelet&&Object.getOwnPropertyNames(p).length>0&&(function(t,e,n){var i=(function(t,e){var n=h.listAnnotatedExecutionPerfMeasurementsForEnsemble(e),i=_.JSStopwatch.createDetachedStopwatch("ensemble",t),r=n.map((function(t){var e=t.measurement,n=t.annotations;return{name:e.name,startTime:e.startTime,endTime:e.startTime+e.totalTime,annotations:n}}));return K(i,r),i})(n,e),r=void 0,o=void 0;for(var a in e)e.hasOwnProperty(a)&&(H.includes(a)&&(t.timesStagesWereReached[a]=e[a].start),["ensemble_init","dws_embedded-app_require_config_callback"].includes(a)&&(r=r?Math.min(r,e[a].end):e[a].end),Y.test(a)&&(o=o?Math.max(o,e[a].end):e[a].end));o&&i.recordTrace("last_js_const_end",o);r&&i.recordTrace("module_init",r)})(t,p,c),d.logBrowserPerfData(c),(function(t,e,n){h.logCumulativeExecutionTimes(t,h.cumulativeExecutionTimesBefore(e,n))})(c,t.timesStagesWereReached,o),this.get_navigation_type()===l.NavigationType.NAVIGATE&&((function(t){var e=m.getReactInitData();K(_.JSStopwatch.createDetachedStopwatch("init_react",t),e)})(c),u.logResourcesData(c)),_.JSStopwatch.log_stored_results(),(function(t,e){return!t.is_page_restore&&(e.navigation_type===l.NavigationType.NAVIGATE||"ajax"===e.navigation_type)})(t,s)){var v=(function(t,e){var n={is_dws:String(t.is_dws),source_type:String(t.source_type)},i="";return t.subtypes.amp_tti_flow?i=t.subtypes.amp_tti_flow:e.dws_page_name&&(i="dws_page_name:"+e.dws_page_name),""!==i&&(n.product=i),e.navigation_type&&(n.navigation_type=e.navigation_type),n})(t,s),w=this.metricsReporter.child(v);(function(t,e){t.time_to_interactive&&e.createStats({ns:"web_timing",name:"temp/time-to-interactive"}).recordDuration(t.time_to_interactive,i.TimeUnit.MILLISECONDS)})(s,w),(function(t,e){var n;for(n in t)if(t.hasOwnProperty(n)){var r=t[n];for(var o in r)if(r.hasOwnProperty(o)){var a=r[o],s=a.transfer_size,c=a.total_size,u=a.count,l=a.total_time,p=a.last_transfer_end;e.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+o+"/count"}).record(u),e.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+o+"/total-time"}).recordDuration(l,i.TimeUnit.MILLISECONDS),e.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+o+"/last-transfer-end"}).recordDuration(p,i.TimeUnit.MILLISECONDS),void 0!==s&&void 0!==c&&c>0&&(e.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+o+"/transferred-size"}).record(s),e.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+o+"/total-size"}).record(c))}}})(g,w),t.is_pagelet&&Object.getOwnPropertyNames(p).length>0&&(function(t,e,n){var r=h.listAnnotatedExecutionPerfMeasurementsForEnsemble(e),o=void 0,a=void 0;r.forEach((function(e){var r=e.measurement,s=r.startTime+r.totalTime;-1!==D.indexOf(r.name)&&n.createStats({ns:"web_timing",name:"temp/ensemble-timing/"+r.name}).recordDuration(s,i.TimeUnit.MILLISECONDS),H.includes(r.name)&&(t.timesStagesWereReached[r.name]=r.startTime),["ensemble_init","dws_embedded-app_require_config_callback"].includes(r.name)&&(o=o?Math.min(o,s):s),Y.test(r.name)&&(a=a?Math.max(a,s):s)})),void 0!==a&&n.createStats({ns:"web_timing",name:"temp/last-js-const-end"}).recordDuration(a,i.TimeUnit.MILLISECONDS),void 0!==o&&n.createStats({ns:"web_timing",name:"temp/module-init"}).recordDuration(o,i.TimeUnit.MILLISECONDS)})(t,p,w),n&&n.getEntriesByType&&((function(t,e){t.getEntriesByType("mark").filter((function(t){return C.indexOf(t.name)>-1})).forEach((function(t){e.createStats({ns:"web_timing",name:"temp/browser-perf/marks/"+t.name}).recordDuration(t.startTime,i.TimeUnit.MILLISECONDS)}))})(n,w),(function(t,e){var n=t.getEntriesByType("navigation")[0],r=void 0===n?null:n;r&&([["temp/browser-perf/navigation/unload-event-start",r.unloadEventStart],["temp/browser-perf/navigation/unload-event-end",r.unloadEventEnd],["temp/browser-perf/navigation/dom-interactive",r.domInteractive],["temp/browser-perf/navigation/dom-content-loaded-event-start",r.domContentLoadedEventStart],["temp/browser-perf/navigation/dom-content-loaded-event-end",r.domContentLoadedEventEnd],["temp/browser-perf/navigation/dom-complete",r.domComplete],["temp/browser-perf/navigation/load-event-start",r.loadEventStart],["temp/browser-perf/navigation/load-event-end",r.loadEventEnd],["temp/browser-perf/navigation/redirect-count",r.redirectCount],["temp/browser-perf/navigation/worker-start",r.workerStart],["temp/browser-perf/navigation/redirect-start",r.redirectStart],["temp/browser-perf/navigation/redirect-end",r.redirectEnd],["temp/browser-perf/navigation/fetch-start",r.fetchStart],["temp/browser-perf/navigation/domain-lookup-start",r.domainLookupStart],["temp/browser-perf/navigation/domain-lookup-end",r.domainLookupEnd],["temp/browser-perf/navigation/connect-start",r.connectStart],["temp/browser-perf/navigation/connect-end",r.connectEnd],["temp/browser-perf/navigation/secure-connect-start",r.secureConnectionStart],["temp/browser-perf/navigation/request-start",r.requestStart],["temp/browser-perf/navigation/response-start",r.responseStart],["temp/browser-perf/navigation/response-end",r.responseEnd],["temp/browser-perf/navigation/transfer-size",r.transferSize]].forEach((function(t){var n=t[0],r=t[1];"number"==typeof r&&e.createStats({ns:"web_timing",name:n}).recordDuration(r,i.TimeUnit.MILLISECONDS)})),[["temp/browser-perf/navigation/encoded-body-size",r.encodedBodySize],["temp/browser-perf/navigation/decoded-body-size",r.decodedBodySize]].forEach((function(t){var n=t[0],i=t[1];"number"==typeof i&&e.createStats({ns:"web_timing",name:n}).record(i)})))})(n,w))}return E.logPaintPerformance(c),E.logVisibilityChangeEvents(t,c),t.have_logged_web_timing=!0,this.log(t,s,!0),c},e.prototype.log=function(e,n,i){void 0===i&&(i=!1),t.prototype.log.call(this,e,n,i)},e})(M),j=(function(){function t(t,e,n,i){this.childSpans=[],this.spanName=t,this.startTime=void 0!==n?n:p.WebTimingUtil.getNow(),this.originTs=e,this.startTimeOffsetMS=this.startTime-e,this.endCallback=i}return t.prototype.startSpan=function(e){var n=new t(e,this.originTs);return this.childSpans.push(n),n},t.prototype.markSpan=function(e,n){var i=new t(e,this.originTs,this.startTime);this.childSpans.push(i),i.endSpan(n)},t.prototype.endSpan=function(t){var e=this;this.endTime=void 0!==t?t:p.WebTimingUtil.getNow(),this.childSpans.forEach((function(t){t.hasEnded()||t.endSpan(e.endTime)})),this.endCallback&&this.endCallback(this)},t.prototype.getEndTimeOffsetMS=function(){return void 0!==this.endTime?this.endTime-this.originTs:void 0},t.prototype.hasEnded=function(){return void 0!==this.endTime},t})(),W=(function(){function t(t,e,n,i){void 0===i&&(i=!1),this.timerState=x.RUNNING,this.loggedEvents=0,this.activeSpans=[],this.endedSpans=[],this.context=t,this.timingStopwatch=e,this.userStopwatch=n,this.id=A++,this.strictAssert=i}return t.prototype.startSpan=function(t){var e=this,n=new j(t,this.context.start_time,void 0,(function(t){e.endSpan(t)}));return this.activeSpans.push(n),n},t.prototype.markSpan=function(t,e){if(void 0===e&&(e={}),this.userStopwatch){var n=void 0===e.startTime?0:e.startTime,i=this.timeSinceStart(e.endTime),r=this.userStopwatch.startSpan(t,{startTime:n});this.userStopwatch.endSpan(t,{spanId:r,endTime:i})}else{var o=new j(t,this.context.start_time,e.startTime);o.endSpan(e.endTime),this.endedSpans.push(o)}},t.prototype.endSpan=function(t){var e=this.activeSpans.indexOf(t);e>=0&&(delete this.activeSpans[e],this.userStopwatch?this.recordSpan(t):this.endedSpans.push(t))},t.prototype.recordSpan=function(t){var e=this,n=this.userStopwatch.startSpan(t.spanName,{startTime:t.startTimeOffsetMS});t.childSpans.forEach((function(t){e.recordSpan(t)})),this.userStopwatch.endSpan(t.spanName,{spanId:n,endTime:t.getEndTimeOffsetMS()})},t.prototype.getContextName=function(){return this.context.context_name},t.prototype.applicationStart=function(){this.logEvent(l.WebTimerEvent.APPLICATION_START)},t.prototype.fetchedDataRequiredForTTI=function(){this.logEvent(l.WebTimerEvent.FETCHED_DATA_FOR_TTI)},t.prototype.startTime=function(){return this.context.start_time},t.prototype.timeSinceStart=function(t){return(t||p.WebTimingUtil.getNow())-this.context.start_time},t.prototype.timeToView=function(){return this.context.time_to_view},t.prototype.timeToInteractive=function(){return this.context.time_to_interactive},t.prototype.reportTTIAfterPaint=function(){var t=this,e=new p.CancellableCallback((function(){t.reportTTI()}));return window.requestAnimationFrame((function(){window.requestAnimationFrame((function(){e.exec()}))})),e},t.prototype.setExtraColumns=function(t){this.context.extra_columns=t},t.prototype.excludeFromTTI=function(t){""!==this.context.tti_exclusion_flow&&(this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+","),this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+t},t.prototype.logEvent=function(t,e){this.logEventInternal(t,!0,e)},t.prototype.logSilentEvent=function(t,e){this.logEventInternal(t,!1,e)},t.prototype.logEventInternal=function(t,e,n){this.loggedEvents|=t.flag,t.ordered&&this.validateEventOrder(t);var i=this.timeSinceStart(n);this.context.timesStagesWereReached[t.name]=i,this.timingStopwatch.recordTrace(t.name,i),console.timeStamp&&console.timeStamp(t.timestampPrefix);var r=S.performance();r&&"function"==typeof r.mark&&r.mark(t.name),e&&t.triggersLogging&&this.logIfReady(t)},t.prototype.validateEventOrder=function(t){for(var e=0,n=0,i=N;n<i.length;n++){var r=i[n];if(r.includes(t))break;for(var o=0,a=r;o<a.length;o++){e|=a[o].flag}}var s=e&this.loggedEvents;if(s>0){var c=l.WebTimerEvent.allEvents.filter((function(t){return(t.flag&s)>0})).map((function(t){return t.name}));this.reportSwMisuse("Received "+t.name+" after ["+c.join(",")+"]")}},t.prototype.logIfReady=function(t){if(this.logger.shouldLog(this.context)){this.addEventBasedTiming();var e=this.logger.logTiming(this.context,t);J(this.timingStopwatch,e),J(this.userStopwatch,e),this.timingStopwatch.logData(),this.userStopwatch.logData(),this.timerState=x.CLOSED}},t.prototype.addEventBasedTiming=function(){var t=S.performance().timing;this.context.ttv_at_dom_interactive&&(this.context.is_pagelet&&window.ensemble?this.context.time_to_view=window.ensemble.getEmbeddedAppDOMInteractive():this.context.time_to_view=t.domInteractive,this.logSilentEvent(l.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),this.context.tti_at_dom_interactive&&(this.context.time_to_interactive=t.domInteractive,this.logSilentEvent(l.WebTimerEvent.MARK_TIME_TO_INTERACTIVE,this.context.time_to_interactive),this.logSilentEvent(l.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive))},t.prototype.reportSwMisuse=function(t){t="WebTimer: "+t,this.strictAssert?T.assert(!1,t):T.reportStack(t,{severity:T.SEVERITY.NONCRITICAL,tags:["web_timing_logger"]})},t})(),q=(function(t){function e(e){var n=t.call(this,e,_.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:e.correlation_id}),_.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:e.correlation_id}),!1)||this;return n.logger=new P,n}return n.__extends(e,t),e.prototype.initialize=function(t){this.context.initialized||(this.context.initialized=!0,this.context.log_time_to_view=t.requireTTV,this.context.log_time_to_interactive=t.requireTTI,this.context.tti_flow=t.url,this.timingStopwatch.url=this.context.tti_flow,this.userStopwatch.url=this.context.tti_flow)},e.prototype.start=function(){this.isUsable()&&this.timerState===x.NEW&&(this.context.start_time=p.WebTimingUtil.getNow(),this.timerState=x.RUNNING)},e.prototype.restart=function(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.have_logged_web_timing=!1,this.context.correlation_id=p.WebTimingUtil.generateCorrelationId(),this.context.start_time=p.WebTimingUtil.getNow(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=x.RUNNING,_.JSStopwatch.deleteStopwatch(this.timingStopwatch),this.timingStopwatch=_.JSStopwatch.createDetachedStopwatch("maestro_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id}),_.JSStopwatch.deleteStopwatch(this.userStopwatch),this.userStopwatch=_.JSStopwatch.createDetachedStopwatch("user_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id})},e.prototype.abort=function(){this.timerState!==x.CLOSED&&(this.timerState=x.ABORTED)},e.prototype.markTimeToView=function(){this.isUsable()&&(null==this.context.time_to_view&&(this.context.time_to_view=p.WebTimingUtil.getNow()),this.logEvent(l.WebTimerEvent.MARK_TIME_TO_VIEW))},e.prototype.markTimeToInteractive=function(){this.isUsable()&&(this.logEvent(l.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),k()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())},e.prototype.reportTTI=function(){null==this.context.time_to_interactive&&(this.context.time_to_interactive=p.WebTimingUtil.getNow(),this.logEvent(l.WebTimerEvent.TIME_TO_INTERACTIVE),Q(this.id))},e.prototype.end=function(t){this.isUsable()&&(void 0===this.context.end_time&&(this.context.end_time=p.WebTimingUtil.getNow()),this.context.request_id=t,this.timingStopwatch.request_id=t,this.userStopwatch.request_id=t,this.logEvent(l.WebTimerEvent.LOAD_END))},e.prototype.waitForTTI=function(t){var e=this;return new Promise((function(n,i){if(null==e.context.time_to_interactive){var r,o=function(t){window.removeEventListener("TTI."+e.id,o),clearTimeout(r),n()};window.addEventListener("TTI."+e.id,o),t&&void 0!==t.timeoutMS&&(r=setTimeout(o,t.timeoutMS))}else n()}))},e.prototype.isUsable=function(){return this.timerState===x.NEW||this.timerState===x.RUNNING},e})(W),U=(function(e){function i(t){var n=e.call(this,t,_.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:t.correlation_id}),_.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:t.correlation_id}),!1)||this;return n.logger=new L,n}return n.__extends(i,e),i.prototype.initialize=function(t){var e=this;if(!this.context.initialized){if(!S.performance())return;this.context.log_time_to_view=t.requireTTV,this.context.log_time_to_interactive=t.requireTTI,this.context.is_pagelet=!!t.is_pagelet,this.context.is_dws=!!t.is_dws,this.context.is_dws2=!!t.is_dws2,this.context.is_early_ensemble=!!t.is_early_ensemble,this.context.is_page_restore=!1,this.context.ttv_at_dom_interactive=!!t.ttv_at_dom_interactive,this.context.tti_at_dom_interactive=!!t.tti_at_dom_interactive,this.context.source_type=null!=t.source_type?t.source_type:"web",this.context.subtypes=null!=t.subtypes?t.subtypes:{},this.context.tti_exclusion_flow=null!=t.tti_exclusion_flow?t.tti_exclusion_flow:"",this.context.have_logged_web_timing=!1,this.context.delayed_tti_for_css=!1,this.context.initialized=!0,t.url&&(this.context.tti_flow=t.url,this.timingStopwatch.url=t.url,this.userStopwatch.url=t.url),this.context.subtypes.tti_flow&&(this.context.tti_flow=this.context.subtypes.tti_flow);var n=0;v.LOG_TIMING_DELAY&&(n=600),_.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),a.window_load((function(){setTimeout((function(){return e.end()}),n)})),c.onPageRestore((function(t){e.context.is_page_restore=!0;var n=_.JSStopwatch.createDetachedStopwatch("browser_perf",{correlation_id:e.context.correlation_id});n.recordTrace("page_restore"),n.logData()})),!this.context.ttv_at_dom_interactive&&window._timingData&&(null!=window._timingData.ttv&&(this.context.time_to_view=window._timingData.ttv.getTime(),this.logEvent(l.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),null!=window._timingData.tti&&(this.context.time_to_interactive=window._timingData.tti.getTime(),this.logEvent(l.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),Q()))}},i.prototype.start=function(){this.isUsable()&&this.timerState===x.NEW&&(this.timerState=x.RUNNING)},i.prototype.restart=function(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.correlation_id=p.WebTimingUtil.generateCorrelationId(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=x.RUNNING,this.timingStopwatch=_.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:this.context.correlation_id}),this.userStopwatch=_.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:this.context.correlation_id})},i.prototype.abort=function(){this.timerState!==x.CLOSED&&(this.timerState=x.ABORTED)},i.prototype.markTimeToView=function(){this.isUsable()&&(null!=this.context.time_to_view||this.context.ttv_at_dom_interactive||(window._timingData&&null!=window._timingData.ttv?this.context.time_to_view=window._timingData.ttv.getTime():this.context.time_to_view=p.WebTimingUtil.getNow(),this.logEvent(l.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)))},i.prototype.markTimeToInteractive=function(){var t=this;if(window.ensemble&&window.ensemble.waitingForCss)return this.context.delayed_tti_for_css=!0,void(window.ensemble.mark_tti_callback=function(){t.markTimeToInteractive()});null!=this.context.time_to_interactive||this.context.tti_at_dom_interactive||(this.logEvent(l.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),k()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())},i.prototype.reportTTI=function(){var e=this;null==this.context.time_to_interactive&&(window._timingData&&null!=window._timingData.tti?this.context.time_to_interactive=window._timingData.tti.getTime():this.context.time_to_interactive=p.WebTimingUtil.getNow(),console.timeStamp&&console.timeStamp("TTI"),window.ensemble&&window.ensemble.snapshotTimingProfile&&(this.context.timing_results=window.ensemble.snapshotTimingProfile()||null),window.RUNNING_IN_EDISON?new Promise((function(e,n){t(["modules/clean/edison/edison"],e,n)})).then(n.__importStar).then((function(t){for(var i=t.Edison.getPrefetchCounts(),r={},o=0,a=Object.keys(i);o<a.length;o++){var s=a[o];r[s]=i[s].toString()}e.context.subtypes=n.__assign(n.__assign({},r),e.context.subtypes),e.logEvent(l.WebTimerEvent.TIME_TO_INTERACTIVE,e.context.time_to_interactive),Q()})):(this.logEvent(l.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),Q()))},i.prototype.end=function(t){this.isUsable()&&void 0===this.context.end_time&&(this.context.end_time=p.WebTimingUtil.getNow(),this.logEvent(l.WebTimerEvent.LOAD_END),this.context.tti_at_dom_interactive&&Q())},i.prototype.waitForTTI=function(t){var e=this;return new Promise((function(n,i){if(window.ensemble){if(window.ensemble.ttiMarked)return void n()}else if(null!=e.context.time_to_interactive)return void n();var r,o=function(t){window.removeEventListener("TTI",o),clearTimeout(r),n()};window.addEventListener("TTI",o),t&&void 0!==t.timeoutMS&&(r=setTimeout(o,t.timeoutMS))}))},i.prototype.isUsable=function(){return this.timerState===x.NEW||this.timerState===x.RUNNING},i})(W),B={};function z(t,e){for(var n={},i=0,r=I;i<r.length;i++){(u=e[c=r[i]])&&(n[c]=String(u))}for(var o=t,a=0,s=O;a<s.length;a++){var c,u;(u=o[c=s[a]])&&(n[c]=String(u))}return{correlation_id:t.correlation_id,request_id:e.request_id,annotations:n}}function J(t,e){if(e.annotations)for(var n in e.annotations)if(e.annotations.hasOwnProperty(n)){var i=e.annotations[n];i&&t.addAnnotation(n,String(i))}e.correlation_id&&t.addAnnotation(_.ReservedAnnotationKey.CORRELATION_ID.id,e.correlation_id),e.request_id&&t.addAnnotation(_.ReservedAnnotationKey.REQUEST_ID.id,e.request_id),e.url&&t.addAnnotation(_.ReservedAnnotationKey.URL.id,e.url)}function F(t){return t?(function(t){var e=t;return B[e]||(B[e]=new q(p.WebTimingUtil.newContext(!0,t))),B[e]})(t):(R||G(),R)}function V(t){void 0===t&&(t={}),F().initialize({requireTTV:!!t.log_time_to_view,requireTTI:!!t.log_time_to_interactive,is_pagelet:t.is_pagelet,is_dws:t.is_dws,is_dws2:t.is_dws2,is_early_ensemble:t.is_early_ensemble,ttv_at_dom_interactive:t.ttv_at_dom_interactive,tti_at_dom_interactive:t.tti_at_dom_interactive,source_type:t.source_type,subtypes:t.subtypes,tti_exclusion_flow:t.tti_exclusion_flow,url:t.url})}function G(){R=new U(p.WebTimingUtil.newContext(!1,"default_timer"))}function K(t,e){t.recordEntries(e.map((function(t){return{type:0!==t.startTime?f.TimingDataType.Span:f.TimingDataType.Trace,name:t.name,startTime:t.startTime,endTime:t.endTime,annotations:t.annotations}}))),t.logData()}G(),e.get_timer=F,e.delete_timer=function(t){delete B[t]},e.time_to_view=function(){return F().timeToView()},e.time_to_interactive=function(){return F().timeToInteractive()},e.initialize_module=V,e.initialize=function(t,e){var i,r=e.dwsOpts;switch(e.sourceType){case y.web_timing_logger.WebTimingLoggerServerContext.SourceType.UNKNOWN:i="unknown";break;case y.web_timing_logger.WebTimingLoggerServerContext.SourceType.MOBILE_WEB:i="mobile";break;case y.web_timing_logger.WebTimingLoggerServerContext.SourceType.DESKTOP_WEB:i="web"}var o={is_pagelet:e.isDws,is_dws:e.isDws,is_dws2:null!=r&&r.isDws2,is_early_ensemble:null!=r&&r.isEarlyEnsemble,subtypes:n.__assign(n.__assign({},e.subtypes),{js_preloading:null!=r&&r.jsPreloading?"true":"false"}),source_type:i,url:e.url};V(n.__assign(n.__assign({},o),t))},e.reset=G,e.start_time=function(){return F().startTime()},e.time_since_start=function(){return F().timeSinceStart()},e.set_tti_exclusion_flow=function(t){F().excludeFromTTI(t)};var H=["ensemble_init","dws_ensemble_init","dws_embedded-app_require_config_callback","dws-processChunk-embedded-app-require_config-1"],Y=new RegExp("dws-processChunk-embedded-app-const_module.*");function X(t){var e=S.performance();if(e&&e.getEntriesByName){for(var n=[],i=0,r=s.get_module_times();i<r.length;i++){var o=r[i],a=o.url;if(void 0===a&&o.name&&-1===o.name.indexOf("!"))T.reportStack("Module "+o.name+" with invalid map object fetched by requirejs",{severity:T.SEVERITY.NONCRITICAL,tags:["log_js_module_timing"]});else{var c=[];if(a&&(c=e.getEntriesByName(a,"resource")),0!==c.length)o.start_time=c[0].startTime+c[0].duration;else{if(!("callback_duration"in o))continue;o.start_time=0}n.push(o)}}t.js_module_times=JSON.stringify(n)}}function Q(t){if(window.ensemble&&window.ensemble.markTTI)window.ensemble.markTTI();else{var e=document.createEvent("Event");null!=t?e.initEvent("TTI."+t,!0,!0):e.initEvent("TTI",!0,!0),window.dispatchEvent(e)}}e.mark_time_to_view=function(){F().markTimeToView()},e.mark_time_to_interactive=function(t){void 0===t&&(t={});var e=F();e.setExtraColumns(t),e.markTimeToInteractive()},e.waitForTTI=function(t){return F().waitForTTI(t)},e.log_js_modules_application_code_start=function(){F().applicationStart()},e.log_js_modules_fetched_data_required_for_tti=function(){F().fetchedDataRequiredForTTI()}})),define("modules/clean/window_util",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.onBeforeUnload=function(t){window.addEventListener("beforeunload",(function e(){t(),window.removeEventListener("beforeunload",e)}))},e.onPageRestore=function(t){window.addEventListener("pageshow",(function e(n){n.persisted&&(t(),window.removeEventListener("pageshow",e))}))}})),define("modules/clean/js_basic_stopwatch",["require","exports","tslib","modules/core/exception"],(function(t,e,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=!(!window.performance||!window.performance.now),a=0;(function(t){t[t.Span=1]="Span",t[t.AsyncSpan=2]="AsyncSpan",t[t.Trace=3]="Trace"})(r=e.TimingDataType||(e.TimingDataType={}));var s=(function(){function t(t,e,i,r,o){void 0===r&&(r=!1),this.name=t,this.strictAssert=e,this.activeSpans={},this.aggregateSpans={},this._annotations=n.__assign({},o),this.spanStack=[],this.stopwatchTags=i||[],this.detached=r}return t.prototype.reset=function(){this.activeSpans={},this.spanStack=[],this.aggregateSpans={},this._annotations={}},Object.defineProperty(t.prototype,"annotations",{get:function(){return this._annotations},enumerable:!0,configurable:!0}),t.prototype.addAnnotation=function(t,e){this._annotations[t]=e},t.prototype.removeAnnotation=function(t){delete this._annotations[t]},t.prototype.popResolvedSpans=function(){if(this.detached)return{};var t=this.aggregateSpans;return this.aggregateSpans={},t},t.prototype.peekResolvedSpans=function(){return this.detached?{}:this.aggregateSpans},t.newSpanID=function(){var t=String(a);return a++,t},t.resolveTime=function(t){return void 0===t&&(t=window.performance.now()),Math.round(t)},t.prototype._resolveParent=function(t){if(t.type===r.Span){var e=this.spanStack[this.spanStack.length-1];if(e)if(e!==t.name)this._report_sw_misuse("Closing "+e+" while the latest open span is "+t.name+".\n        You are either mixing sync and async spans or closing sync spans out of order.");else{this.spanStack.pop();for(var n="",i=0,o=this.spanStack;i<o.length;i++){n+=o[i]+"#"}t.parent=n}else this._report_sw_misuse(t.name+' isn\'t a synchronous span and has to be started with "async:true".')}else t.parent=""},t.prototype.recordTrace=function(e,i){void 0===i&&(i={});var o=t.resolveTime(i.traceTime),a=t.newSpanID(),s={name:e,span_id:a,start_time:0,end_time:o,annotations:n.__assign({},i.annotations),type:r.Trace,parent:""};return this.recordSpan(this.stopwatchTags,s),a},t.prototype.start=function(e,i){void 0===i&&(i={}),e||this._report_sw_misuse("Reporting a span without a name");var o=t.resolveTime(i.startTime);i.async||this.spanStack.push(e);var a=t.newSpanID(),s={name:e,span_id:a,start_time:o||0,annotations:n.__assign({},i.annotations),type:i.async?r.AsyncSpan:r.Span};return e in this.activeSpans||(this.activeSpans[e]=[]),this.activeSpans[e].push(s),a},t.prototype.end=function(e,n){void 0===n&&(n={});var i=this.findTimerDataIndex(e,n.spanId);if(-1!==i){var r=this.activeSpans[e],o=r[i];r.splice(i,1),this._resolveParent(o);var a=t.resolveTime(n.endTime);if(!(a<o.start_time))return o.end_time=a,this.recordSpan(this.stopwatchTags,o),o.span_id;this._report_sw_misuse("span "+e+" has set an endTime earlier than start_time")}},t.prototype.addSpanAnnotation=function(t,e,n,i){var r=this.findTimerDataIndex(t,i);-1!==r&&(this.activeSpans[t][r].annotations[e]=n)},t.prototype.attach=function(){this.detached=!1},t.prototype.findTimerDataIndex=function(t,e){if(!(t in this.activeSpans)||0===this.activeSpans[t].length)return this._report_sw_misuse("tried to find "+t+" but that span doesn't exist"),-1;var n=-1,i=this.activeSpans[t];if(void 0===e)n=0;else for(var r=0;r<i.length;r++)if(i[r].span_id===e){n=r;break}return-1===n&&this._report_sw_misuse("tried to find "+t+" with id "+e+" but that span doesn't exist"),n},t.prototype._report_sw_misuse=function(t){t="JSBasicStopwatch "+this.name+": "+t,this.strictAssert?i.assert(!1,t):i.reportStack(t,{severity:i.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},t.prototype.recordSpan=function(t,e){var n=""+e.parent+e.name;n in this.aggregateSpans||(this.aggregateSpans[n]={name:e.name,start_time:e.start_time,total_time:0,num_calls:0,annotations:Object.keys(e.annotations).length>0?e.annotations:void 0,parent:e.parent||"",stopwatch_tags:t.length>0?t:void 0,type:e.type});var i=this.aggregateSpans[n];if(void 0!==e.end_time){if(i.type===r.Trace?(i.total_time=e.end_time-e.start_time,i.num_calls=1):(i.total_time+=e.end_time-e.start_time,i.num_calls+=1),Object.keys(e.annotations).length>0)if(i.annotations)for(var o in e.annotations)e.annotations.hasOwnProperty(o)&&(i.annotations[o]=e.annotations[o]);else i.annotations=e.annotations}else this._report_sw_misuse("Span "+n+" reported with undefined end_time")},t})();e.JSBasicStopwatchImpl=s;var c=(function(){function t(){this.name="",this.annotations={}}return t.prototype.reset=function(){},t.prototype.attach=function(){},t.prototype.addAnnotation=function(t,e){},t.prototype.removeAnnotation=function(t){},t.prototype.popResolvedSpans=function(){return{}},t.prototype.peekResolvedSpans=function(){return{}},t.prototype.start=function(t,e){},t.prototype.end=function(t,e){},t.prototype.recordTrace=function(t,e){},t.prototype.addSpanAnnotation=function(t,e,n,i){},t})();e.NoopStopwatchInstance=new c,e.createStopwatch=function(t,n,i,r,a){return void 0===r&&(r=!1),o?new s(t,n,i,r,a):e.NoopStopwatchInstance}})),define("modules/clean/js_client_stopwatch",["require","exports","tslib","modules/core/xhr","modules/clean/js_basic_stopwatch","modules/constants/request","modules/core/browser","modules/core/exception"],(function(t,e,n,i,r,o,a,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o=n.__importStar(o),a=n.__importStar(a);var c=(function(){function t(t){this.id=t}return t.REQUEST_ID=new t("dropbox.js_client_stopwatch.request_id"),t.CORRELATION_ID=new t("dropbox.js_client_stopwatch.correlation_id"),t.URL=new t("dropbox.js_client_stopwatch.url"),t})();e.ReservedAnnotationKey=c;var u=(function(){function t(){this.GLOBAL_SW_NAME="GLOBAL_STOPWATCH",this.flush_interval=6e4,this.debugEnabled=!0,this.strictAssert=!1,this.intervalId=null,this.clientStopwatchCounter=1,this.reset()}return t.prototype.reset=function(){this.globalStopwatches={},this.clientStopwatches={},this.clientStopwatchCounter=1,this.sentInitialData=!1,this.create_stopwatch(this.GLOBAL_SW_NAME),this.intervalId&&clearInterval(this.intervalId),this.intervalId=null},t.prototype.reset_individual_stopwatch=function(t){this.stopwatch_exists(t)?this.globalStopwatches[t].reset():this._report_sw_misuse("tried to reset the stopwatch "+t+" but it does not exist")},t.prototype.stopwatch_exists=function(t){return t in this.globalStopwatches},t.prototype.create_stopwatch=function(t,e){this.stopwatch_exists(t)?this._report_sw_misuse("tried to create a new stopwatch "+t+" but it already exists"):this.globalStopwatches[t]=r.createStopwatch(t,this.strictAssert,e)},t.prototype.createDetachedStopwatch=function(t,e){void 0===e&&(e={});var n=r.createStopwatch(t,this.strictAssert,e.tags,!0,e.annotations),i=new l(this.clientStopwatchCounter++,t,n,e.request_id,e.correlation_id,e.url);return this.clientStopwatches[i.id]=i,i},t.prototype.deleteStopwatch=function(t){delete this.clientStopwatches[t.id]},t.prototype.create_stopwatch_if_not_exist=function(t,e){this.stopwatch_exists(t)||this.create_stopwatch(t,e)},t.prototype.getStopwatch=function(t){return this.stopwatch_exists(t)?this.globalStopwatches[t]:(this._report_sw_misuse(t+" doesn't exist"),null)},t.prototype.recordTrace=function(t,e){void 0===e&&(e={});var n=this.getStopwatch(e.stopwatchName||this.GLOBAL_SW_NAME);if(null!=n){var i={traceTime:e.traceTime};return n.recordTrace(t,i)}},t.prototype.startSpan=function(t,e){void 0===e&&(e={});var n=this.getStopwatch(e.stopwatchName||this.GLOBAL_SW_NAME);if(null!=n){var i={startTime:e.startTime,async:e.async};return n.start(t,i)}},t.prototype.endSpan=function(t,e){void 0===e&&(e={});var n=this.getStopwatch(e.stopwatchName||this.GLOBAL_SW_NAME);if(null!=n)return n.end(t,{spanId:e.spanId,endTime:e.endTime})},t.prototype.addSpanAnnotation=function(t,e,n,i){void 0===i&&(i={});var r=this.getStopwatch(i.stopwatchName||this.GLOBAL_SW_NAME);null!=r&&r.addSpanAnnotation(t,e,n,i.spanId)},t.prototype.log_stored_results=function(){this.sentInitialData?this._report_sw_misuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.flush_current_data(),this.sentInitialData=!0,this.intervalId=setInterval(this.flush_current_data.bind(this),this.flush_interval))},t.prototype._report_sw_misuse=function(t){t="ClientStopwatch: "+t,this.strictAssert?s.assert(!1,t):s.reportStack(t,{severity:s.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},t.prototype.flush_current_data=function(){for(var e in this.globalStopwatches)this.globalStopwatches.hasOwnProperty(e)&&t.logStopwatchData(this.globalStopwatches[e]);for(var e in this.clientStopwatches)this.clientStopwatches.hasOwnProperty(e)&&t.logStopwatchData(this.clientStopwatches[e].stopwatch)},t.logStopwatchData=function(e){var n=e.popResolvedSpans(),i=e.name,r={};if(Object.keys(n).length>t.MAXSPANS){var o=0;for(var a in r[i]={},n)n.hasOwnProperty(a)&&(r[i][a]=n[a],o===t.MAXSPANS&&(r[i].annotations=e.annotations,t.send_spans(r),o=0,r[i]={}),o++)}else r[i]=n;0!==Object.keys(r[i]).length&&(r[i].annotations=e.annotations,t.send_spans(r))},t.send_spans=function(t){var e=JSON.stringify(t),n={request_id:o.REQUEST_ID,url:a.get_href().replace("/dws2",""),aggregated_sw_data:e};i.sendXhr("/log_js_sw_data",n)},t.prototype.print_stopwatches_debug=function(){var t=this.get_debug_data();console.table&&console.groupCollapsed&&console.groupEnd&&t&&t.length>0&&(console.groupCollapsed("Request timeline"),console.table(t),console.groupEnd())},t.prototype.get_debug_data=function(){var t=[];for(var e in this.globalStopwatches)if(this.globalStopwatches.hasOwnProperty(e)){var n=this.globalStopwatches[e].peekResolvedSpans();for(var i in n)if(n.hasOwnProperty(i)){var o=n[i],a={stopwatchName:e,spanName:o.name,time:o.start_time+o.total_time};o.type!==r.TimingDataType.AsyncSpan&&o.type!==r.TimingDataType.Span||(a.startTime=o.start_time),o.type===r.TimingDataType.Span&&(a.info="Total time: "+o.total_time+"ms"),t.push(a)}}return t.sort((function(t,e){return t.time-e.time})),t},t.MAXSPANS=2e3,t})();e.JSStopwatch=new u;var l=(function(){function t(t,e,n,i,r,o){this.sentInitialData=!1,this.strictAssert=!1,this.id=t,this.stopwatch=n,this._request_id=i,this._correlation_id=r,this._url=o,this._request_id&&this.stopwatch.addAnnotation(c.REQUEST_ID.id,this._request_id),this._correlation_id&&this.stopwatch.addAnnotation(c.CORRELATION_ID.id,this._correlation_id),this._url&&this.stopwatch.addAnnotation(c.URL.id,this._url)}return Object.defineProperty(t.prototype,"request_id",{set:function(t){this._request_id=t,this._request_id?this.stopwatch.addAnnotation(c.REQUEST_ID.id,this._request_id):this.stopwatch.removeAnnotation(c.REQUEST_ID.id)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"correlation_id",{set:function(t){this._correlation_id=t,this._correlation_id?this.stopwatch.addAnnotation(c.CORRELATION_ID.id,this._correlation_id):this.stopwatch.removeAnnotation(c.CORRELATION_ID.id)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{set:function(t){this._url=t,this._url?this.stopwatch.addAnnotation(c.URL.id,this._url):this.stopwatch.removeAnnotation(c.URL.id)},enumerable:!0,configurable:!0}),t.prototype.startSpan=function(t,e){return this.stopwatch.start(t,e)},t.prototype.endSpan=function(t,e){return this.stopwatch.end(t,e)},t.prototype.addSpanAnnotation=function(t,e,n,i){this.stopwatch.addSpanAnnotation(t,e,n,i)},t.prototype.recordTrace=function(t,e,n){this.stopwatch.recordTrace(t,{traceTime:e,annotations:n})},t.prototype.recordEntries=function(t){for(var e=0,n=t;e<n.length;e++){var i=n[e];if(i.type===r.TimingDataType.Trace)this.recordTrace(i.name,i.endTime,i.annotations);else{var o=i.startTime||0,a=this.startSpan(i.name,{startTime:Math.min(o,i.endTime),async:i.type===r.TimingDataType.AsyncSpan,annotations:i.annotations});i.endTime<o&&this.addSpanAnnotation(i.name,"negativeSpanLength",(i.endTime-o).toString(),a),this.endSpan(i.name,{spanId:a,endTime:Math.max(o,i.endTime)})}}},t.prototype.logData=function(){this.sentInitialData?this.reportMisuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.stopwatch.attach(),this.sentInitialData=!0,setTimeout((function(){e.JSStopwatch.flush_current_data()}),0))},t.prototype.addAnnotation=function(t,e){this.stopwatch.addAnnotation(t,e)},t.prototype.removeAnnotation=function(t){this.stopwatch.removeAnnotation(t)},t.prototype.reportMisuse=function(t){t="ClientStopwatch: "+t,this.strictAssert?s.assert(!1,t):s.reportStack(t,{severity:s.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},t})()})),define("apex-metrics",["require","exports"],(function(t,e){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.TimeUnit=n,(function(t){t[t.NANOSECONDS=0]="NANOSECONDS",t[t.MILLISECONDS=1]="MILLISECONDS",t[t.SECONDS=2]="SECONDS",t[t.MINUTES=3]="MINUTES",t[t.HOURS=4]="HOURS",t[t.DAYS=5]="DAYS"})(n||(e.TimeUnit=n={}));var i=(function(){function t(){}return t.toMilliseconds=function(t){switch(t.unit){case n.NANOSECONDS:return t.value/1e6;case n.MILLISECONDS:return t.value;case n.SECONDS:return 1e3*t.value;case n.MINUTES:return 6e4*t.value;case n.HOURS:return 36e5*t.value;case n.DAYS:return 24*t.value*36e5}},t})();e.Instant=i;var r=(function(){function t(){}return t.prototype.now=function(){return{value:performance.now(),unit:n.MILLISECONDS}},t})();e.BrowserPerformanceClock=r;var o=(function(){function t(t){this.jitterStrategy=t}return t.prototype.executeEvery=function(t,e){var n=this,r=i.toMilliseconds(t),o=i.toMilliseconds(this.jitterStrategy());setTimeout((function(){e()&&n.executeEvery(t,e)}),r+o)},t})();e.SetTimeoutExecutor=o;var a=new RegExp("^[^0-9a-zA-Z]+"),s=new RegExp("[^0-9a-zA-Z._-]","g"),c=s,u=new RegExp("[^0-9a-zA-Z/._-]","g"),l=s;function p(t){return{ns:d(t.ns),name:m(t.name)}}function _(t){var e={};for(var n in t){if(t.hasOwnProperty(n))e[h(n,"tag name",256,a,l)]=h(t[n],"tag value",256)}return e}function d(t){return h(t,"namespace",256,a,c)}function m(t){return h(t,"metric name",256,a,u)}function h(t,e,n,i,r){var o=[];if("string"!=typeof t&&o.push("identifier is not a string"),i&&i.test(t)&&o.push("invalid prefix"),r&&r.test(t)&&o.push("invalid characters"),t.length>n&&o.push("exceeds "+n+" characters"),0===t.length&&o.push("is empty"),0!==o.length)throw new Error(e+" identifier '"+t+"' is invalid: "+o);return t}e.validateMetric=p,e.validateTags=_,e.validateNamespace=d,e.validateMetricName=m;var f=(function(){function t(t,e,n){void 0===n&&(n={}),this.sink=t,this.clock=e,this.tags=n}return t.root=function(e,n){return new t(e,n)},t.prototype.child=function(e){return new t(this.sink,this.clock,Object.assign(Object.assign({},this.tags),_(e)))},t.prototype.createStats=function(t,e){return void 0===e&&(e={}),new g(p(t),Object.assign(Object.assign({},this.tags),_(e)),this.sink)},t.prototype.createCounter=function(t,e){return void 0===e&&(e={}),new v(p(t),Object.assign(Object.assign({},this.tags),_(e)),this.sink)},t.prototype.createTimer=function(t,e){return void 0===e&&(e={}),new w(p(t),Object.assign(Object.assign({},this.tags),_(e)),this.sink,this.clock)},t})();e.MetricsReporterImpl=f;var g=(function(){function t(t,e,n){this.metric=t,this.tags=e,this.sink=n}return t.prototype.record=function(t){S(t,this.metric,this.tags,this.sink)},t.prototype.recordDuration=function(t,e){S(i.toMilliseconds({value:t,unit:e}),this.metric,this.tags,this.sink)},t})(),v=(function(){function t(t,e,n,i){void 0===i&&(i=0),this.metric=t,this.tags=e,this.sink=n,this.value=i}return t.prototype.decrement=function(t){void 0===t&&(t=1),this.value-=t},t.prototype.increment=function(t){void 0===t&&(t=1),this.value+=t},t.prototype.reset=function(t){void 0===t&&(t=0),this.value=t},t.prototype.record=function(){S(this.value,this.metric,this.tags,this.sink),this.reset()},t})(),w=(function(){function t(t,e,n,r,o){void 0===o&&(o=0),this.metric=t,this.tags=e,this.sink=n,this.clock=r,this.value=o,this.value=i.toMilliseconds(this.clock.now())}return t.prototype.record=function(){S(i.toMilliseconds(this.clock.now())-this.value,this.metric,this.tags,this.sink),this.reset()},t.prototype.reset=function(){this.value=i.toMilliseconds(this.clock.now())},t})();function S(t,e,n,i){i.recordSpan({namespace:e.ns,metricName:e.name,tags:n,samples:[t]})}var T=(function(){function t(){}return t.prototype.recordSpan=function(t){},t})();e.NoOpSink=T;var b=(function(){function t(){}return t.prototype.executeEvery=function(t,e){},t})();e.NoOpExecutor=b})),define("google/protobuf/any",["require","exports","tslib","protobufjs/minimal"],(function(t,e,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o,a=(i=n.__importStar(i)).Reader,s=i.Writer,c=i.util,u=i.roots.default||(i.roots.default={});e.default=u,e.google=u.google=((r=u.google||{}).protobuf=((o=r.protobuf||{}).Any=(function(t){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.typeUrl="",t.prototype.value=c.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=s.create()),null!=t.typeUrl&&Object.hasOwnProperty.call(t,"typeUrl")&&e.uint32(10).string(t.typeUrl),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).bytes(t.value),e},t.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new u.google.protobuf.Any;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.typeUrl=t.string();break;case 2:i.value=t.bytes();break;default:t.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/google.protobuf.Any"},t})(o.Any||{}),o),r)})),define("proto_utils/unpack",["require","exports","google/protobuf/any"],(function(t,e,n){"use strict";function i(t){return t.constructor.encode(t).finish()}Object.defineProperty(e,"__esModule",{value:!0}),e.wrapInProtoAny=function(t,e){var r={value:i(t)};return null!=e&&(r.typeUrl=e),n.google.protobuf.Any.create(r)},e.packProto=function(t){for(var e=i(t),n="",r=0;r<e.byteLength;r++)n+=String.fromCharCode(e[r]);return btoa(n)},e.unpackProto=function(t,e){for(var i=atob(t),r=i.length,o=new Uint8Array(r),a=0;a<r;a++)o[a]=i.charCodeAt(a);var s,c=function(t){try{return e.decode(t)}catch(t){throw new Error("Invalid data while trying to unpack encoded proto: "+t)}};try{s=n.google.protobuf.Any.decode(o)}catch(t){}return s&&s.typeUrl&&s.typeUrl.startsWith("type.googleapis.com/")&&s.value?c(s.value):c(o)}})),define("dropbox/proto/js_init_data/web_timing_logger/web_timing_logger",["require","exports","tslib","protobufjs/minimal"],(function(t,e,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=(i=n.__importStar(i)).Reader,a=i.Writer,s=i.util,c=i.roots.default||(i.roots.default={});e.default=c,e.web_timing_logger=c.web_timing_logger=((r=c.web_timing_logger||{}).WebTimingLoggerServerContext=(function(t){function t(t){if(this.subtypes={},t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e,n;return t.prototype.isDws=!1,t.prototype.dwsOpts=null,t.prototype.sourceType=0,t.prototype.subtypes=s.emptyObject,t.prototype.url="",t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=a.create()),null!=t.isDws&&Object.hasOwnProperty.call(t,"isDws")&&e.uint32(8).bool(t.isDws),null!=t.dwsOpts&&Object.hasOwnProperty.call(t,"dwsOpts")&&c.web_timing_logger.WebTimingLoggerServerContext.DWSOptions.encode(t.dwsOpts,e.uint32(18).fork()).ldelim(),null!=t.sourceType&&Object.hasOwnProperty.call(t,"sourceType")&&e.uint32(24).int32(t.sourceType),null!=t.subtypes&&Object.hasOwnProperty.call(t,"subtypes"))for(var n=Object.keys(t.subtypes),i=0;i<n.length;++i)e.uint32(34).fork().uint32(10).string(n[i]).uint32(18).string(t.subtypes[n[i]]).ldelim();return null!=t.url&&Object.hasOwnProperty.call(t,"url")&&e.uint32(42).string(t.url),e},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n,i,r=void 0===e?t.len:t.pos+e,a=new c.web_timing_logger.WebTimingLoggerServerContext;t.pos<r;){var u=t.uint32();switch(u>>>3){case 1:a.isDws=t.bool();break;case 2:a.dwsOpts=c.web_timing_logger.WebTimingLoggerServerContext.DWSOptions.decode(t,t.uint32());break;case 3:a.sourceType=t.int32();break;case 4:a.subtypes===s.emptyObject&&(a.subtypes={});var l=t.uint32()+t.pos;for(n="",i="";t.pos<l;){var p=t.uint32();switch(p>>>3){case 1:n=t.string();break;case 2:i=t.string();break;default:t.skipType(7&p)}}a.subtypes[n]=i;break;case 5:a.url=t.string();break;default:t.skipType(7&u)}}return a},t.getTypeUrl=function(){return"type.googleapis.com/web_timing_logger.WebTimingLoggerServerContext"},t.DWSOptions=(function(t){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.isDws2=!1,t.prototype.isEarlyEnsemble=!1,t.prototype.jsPreloading=!1,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=a.create()),null!=t.isDws2&&Object.hasOwnProperty.call(t,"isDws2")&&e.uint32(8).bool(t.isDws2),null!=t.isEarlyEnsemble&&Object.hasOwnProperty.call(t,"isEarlyEnsemble")&&e.uint32(16).bool(t.isEarlyEnsemble),null!=t.jsPreloading&&Object.hasOwnProperty.call(t,"jsPreloading")&&e.uint32(24).bool(t.jsPreloading),e},t.decode=function(t,e){t instanceof o||(t=o.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new c.web_timing_logger.WebTimingLoggerServerContext.DWSOptions;t.pos<n;){var r=t.uint32();switch(r>>>3){case 1:i.isDws2=t.bool();break;case 2:i.isEarlyEnsemble=t.bool();break;case 3:i.jsPreloading=t.bool();break;default:t.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/web_timing_logger.WebTimingLoggerServerContext.DWSOptions"},t})(t.DWSOptions||{}),t.SourceType=(e={},(n=Object.create(e))[e[0]="UNKNOWN"]=0,n[e[1]="DESKTOP_WEB"]=1,n[e[2]="MOBILE_WEB"]=2,n),t})(r.WebTimingLoggerServerContext||{}),r)}));
//# sourceMappingURL=pkg-timing.min.js-vflvaKjqy.map