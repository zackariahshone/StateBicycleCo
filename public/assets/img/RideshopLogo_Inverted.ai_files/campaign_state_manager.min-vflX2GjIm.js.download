define(["require","exports","tslib","modules/core/uri","modules/clean/react/prompt/version","modules/clean/upsell/prompt_event_logger","modules/clean/upsell/prompt_event_emitter"],(function(t,n,e,o,r,i,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PROMPT_CONFIRM_ENDPOINT_URL="/prompt/confirm_v2";var c=(function(){function t(t){var o=this;this.buildConfirmEndpointURI=function(t){if(!(t=t||o.getConfirmUrlFromContent())||"#"===t)return"#";var e=o.eventLogger.getUpsellControllerURI(n.PROMPT_CONFIRM_ENDPOINT_URL),r=o.component.props.campaign.content,i="confirmIsPost"in r&&r.confirmIsPost,s=o.getRedirectURL(t);return s&&e.updateQuery({redirect_url:s}),i&&e.updateQuery({preserve_post:"1"}),e.toString()},this.shouldConfirmUsingPost=function(){var t=o.getConfirmUrlFromContent(),n=o.component.props.campaign.content,e="confirmIsPost"in n&&n.confirmIsPost;return!!(t&&"#"!==t||e)},this.onShow=function(){o.component.state.isShown||(o.component.setState((function(t){return e.__assign(e.__assign({},t),{isShown:!0})})),s.promptBufferedEventEmitter.emit(s.Events.ON_PROMPT_SHOWN,o.component.props.campaign.campaignLocationId),o.eventLogger.triggerExternalEvent("db:prompt:show"),o.eventLogger.recordClientImpression())},this.onConfirm=function(t){o.isAckInProgress()||(o.component.setState((function(t){return e.__assign(e.__assign({},t),{isConfirmed:!0})})),o.eventLogger.triggerExternalEvent("db:prompt:pre-confirm"),o.ensureConfirmIsRecorded(t))},this.isHTMLAnchorElement=function(t){return void 0!==t.href},this.isHTMLFormElement=function(t){return void 0!==t.action},this.onDismiss=function(t,n){o.isAckInProgress()||(o.component.setState((function(t){return e.__assign(e.__assign({},t),{isDismissed:!0})})),t.preventDefault(),s.promptBufferedEventEmitter.emit(s.Events.ON_PROMPT_DISMISSED,o.component.props.campaign.campaignLocationId),o.eventLogger.triggerExternalEvent("db:prompt:pre-dismiss"),o.eventLogger.recordDismiss(n&&n.remindMeLater))},this.enhanceHTMLButtons=function(t,n){var e=void 0===n?{}:n,r=e.confirmButtonSelector,i=void 0===r?".confirm-button":r,s=e.dismissButtonSelector,c=void 0===s?".dismiss-button":s,p=e.onConfirmOverride,m=void 0===p?void 0:p,a=e.onDismissOverride,u=void 0===a?void 0:a;if(t){for(var f=null,g=t.querySelectorAll(i),d=t.querySelectorAll(c),l=0;l<g.length;l++)if(f=g[l],o.mayEnhanceButton(f)){f.href=o.buildConfirmEndpointURI(f.getAttribute("href"));var v=o.component.props.campaign.content,h="confirmInNewTab"in v&&v.confirmInNewTab;f.target=h?"_blank":"_self",f.addEventListener("click",m||o.onConfirm)}for(l=0;l<d.length;l++)f=d[l],o.mayEnhanceButton(f)&&f.addEventListener("click",u||o.onDismiss)}},this.component=t,this.eventLogger=new i.PromptEventLogger(this.component.props)}return t.prototype.getConfirmUrlFromContent=function(){var t=this.component.props.campaign.content;return r.isTopNotificationContent(t)?t.buttonUrl:r.isTargetedBubbleContent(t)||r.isConfirmableContent(t)?t.confirmUrl:void 0},t.prototype.getRedirectURL=function(t){if(t){if(this.component.props.campaign.addTkParams){var n=o.URI.parse(t),e=this.component.props.campaign.versionId;return null==e&&(e=this.component.props.campaign.campaignId),n.updateQuery({_tk:this.component.props.campaign.campaignLocationTkId,_camp:e.toString()}),n.toString()}return t}},t.prototype.ensureConfirmIsRecorded=function(t){if(!this.eventWillRecordConfirm(t)){this.eventLogger.recordConfirm();var n=this.getEventHrefOrAction(t);n&&"#"!==n||t.preventDefault()}},t.prototype.eventWillRecordConfirm=function(t){return(this.getEventHrefOrAction(t)||"").indexOf(n.PROMPT_CONFIRM_ENDPOINT_URL)>-1},t.prototype.getEventHrefOrAction=function(t){var n=null,e=t.currentTarget;return e&&this.isHTMLAnchorElement(e)?n=e.getAttribute("href"):e&&this.isHTMLFormElement(e)&&(n=e.getAttribute("action")),n},t.prototype.mayEnhanceButton=function(t){return!t.classList.contains("prompt-enhanced")&&(t.classList.add("prompt-enhanced"),!0)},t.prototype.isAckInProgress=function(){return this.component.state.isConfirmed||this.component.state.isDismissed},t})();n.CampaignStateManager=c}));
//# sourceMappingURL=campaign_state_manager.min.js-vflfa9INt.map